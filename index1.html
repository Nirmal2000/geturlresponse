<input type="text" id="get_url" >
<input type ="button" value="Get response" id='btn' onclick="get_response()">
<p id="response"></p>


<script>
if(navigator.onLine == false){
    document.getElementById('response').innerHTML = "No Internet"
    document.getElementById('btn').disabled  = true
}

htmlelements = {
    response:function(){
        return document.getElementById("response")
    },
    get_url:function(){
        return document.getElementById("get_url").value
    }
}

function get_response(){
    var xtp = new XMLHttpRequest

    xtp.onreadystatechange = function(){
        if(this.status=404){
            document.getElementById('response').innerHTML=this.statusText
        }
        if(this.status=200 && this.readyState==4){
            if(this.responseText == "INVALID PROTOCOL"){
                document.getElementById('response').innerHTML=this.responseText    
            }
            else if(this.responseText){
                document.getElementById('response').innerHTML=this.responseText
                if(document.getElementById("download")){
                    btn=document.getElementById("download")
                    btn.innerHTML = htmlelements.get_url()
                    btn.setAttribute("onClick", "download_file()");
                    
                }
                else{
                    var btn = document.createElement("button"); 
                    btn.id = "download" 
                    btn.innerHTML = htmlelements.get_url()
                    btn.setAttribute("onClick", "download_file()");                
                    document.body.appendChild(btn);
                }
            }
            else{
                if(navigator.onLine)
                document.getElementById('response').innerHTML = "INVALID URL"
                else
                document.getElementById('response').innerHTML = "Make sure you are connected to the Internet"
            }
        }        
    }

    xtp.onerror= function(){
        document.getElementById('response').innerHTML=this.statusText
    }
    
    xtp.open("get","/url?f="+htmlelements.get_url())
    xtp.send()
    
}

function download_file(){
    
    var xtp = new XMLHttpRequest
    xtp.open("get","file?f="+document.getElementById('response').innerHTML)
    xtp.responseType="blob"
    xtp.onload = function (event) {
        var blob = xtp.response;
        var link=document.createElement('a');
        link.href=window.URL.createObjectURL(blob);
        link.download="file.txt";
        link.innerHTML = "LINK"
        link.click();
     };
    xtp.send()
}

window.addEventListener('online',()=>{
    document.getElementById("response").innerHTML = "Connection established"
    document.getElementById("btn").disabled = false
})
window.addEventListener('offline',()=>{
    document.getElementById("response").innerHTML = "No Internet"
    document.getElementById("btn").disabled = true
})
</script>